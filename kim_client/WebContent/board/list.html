<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>게시판</title>
<link rel="stylesheet"
	href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.css">
<link rel="stylesheet" href="/kim_client/css/main.css">
<link rel="stylesheet"
	href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<script
	src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<!-- 제이쿼리 -->
<script
	src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
<!-- 부트스트랩 -->
<script
	src="https://cdnjs.cloudflare.com/ajax/libs/toastr.js/latest/toastr.min.js"></script>

<script src="/kim_client/script/main.js?ver1"></script>
<!-- ?ver1 -->
<style>
.modal {
	text-align: center;
}

.modal-dialog {
	display: inline-block;
	text-align: left;
	vertical-align: middle;
}

* {
	border: 0;
	margin: 0;
}

td a {
	width: 100%;
}
</style>
<script>
function getToday() {
	const today = new Date();
	let dd=today.getDate(); //일 반환
	let mm=today.getMonth()+1; //월 반환 (1월이 0이기 때문에 +1)
	let yyyy=today.getFullYear();
	if(dd<10)
		dd='0'+dd; //1자리 숫자 앞에 0 붙이기
	return yyyy+"-"+mm+"-"+dd;
}

	$(function () {
		//서버에 보내줄 페이징 결과를 저장
		let page = undefined;
		//1.주소에서 pageno, pagesize, writer를 분리하고 쿼리스트링을 만들어 Ajax요청을 보냄
		let queryString="pageno=1"; 
		if(location.search!=""){ //첫페이지가 아니라면
			//console.log(location.search); //?pageno=2
			//console.log(location.search.substr(1)); //pageno=2
			queryString = location.search.substr(1);
		}
		$.ajax({
			url:"http://192.168.0.99/cha_board/api/boards",
			method:"get",
			data:queryString+"&apiKey="+apiKey
		}).done((result, textStatus,request)=>{
			console.log("result=",result);
			page = result;
			printData();//게시글 table 넣을 내용 
		}).fail((xhr)=>printError(xhr, "결과를 출력할 수 없습니다."));
		
		function printData() {
			const boards = page.boards; //게시글만 저장
			//const pagination = getPagination(page); //pagination 저장
			//게시판 글들만 출력
			const $tbody = $("#boards tbody");
			
			$.each(boards, function(i, $board) {
				const $tr=$("<tr>").appendTo($tbody);
				$("<td>").text($board.bno).appendTo($tr);
				
				//두번째 td는 첨부파일이 있는 경우 클립모양 아이콘 출력.없으면 공백
				if($board.attachmentExist==true){
					$("<td>").css("text-align","right").attr("title","첨부파일").appendTo($tr); //미완성
				}else 
					$("<td>").appendTo($tr);
				
				//세번째 td : 제목을 출력 하고 링크 걸기
				const $td=$("<td></td>").text($board.title).appendTo($tr);
				const $link = $("<a>").attr("href", "/cha_client/board/read.html?bno=" + $board.bno);
				$($td).wrapInner($link); //부모안에 쏴라
				//제목에 a태그
				
				
				//네번째td : 글쓴이
				$("<td></td>").append($("<a></a>").attr("class","user").attr("data-toggle","modal")
						.attr("data-target","#modal1").attr("data-id", $board.writer).text($board.writer)).appendTo($tr);
				<!--data-XX 속성은 내부값을 저장하기 쓴다.-->
				
				//다섯번째td: 날짜, 오늘 작성한 글은 시분초를 , 그이전글은 년월일 출력
				const writeDate=$board.writeDate.split(" ");  //split(쪼개다)
				console.log(writeDate[0]); //년 월 일
				console.log(writeDate[1]); //시 분 초
				
				const today = getToday(); //오늘 날짜를 직접 정의
				if(today==writeDate[0]){
					$("<td>").text(writeDate[1]).appendTo($tr);
				}else{
					$("<td>").text(writeDate[0]).appendTo($tr);
				}
				$("<td>").text($board.readCnt).appendTo($tr);
			
				
			}); //end each
			
		}
		
	}) //ready End
</script>
</head>

<body>
	<div id="page">
		<header id="header"> </header>
		<nav id="nav"></nav>
		<div id="main">
			<aside id="aside"></aside>
			<section id="section">
				<!-- 서버에서 받은 게시글 출력할 영역 -->
				<div>
					<table id="boards" class="table table-hover">
						<colgroup>
							<!-- 열너비 지정 -->
							<col width="10%">
							<col width="10%">
							<col width="40%">
							<col width="10%">
							<col width="25%">
							<col width="10%">
						</colgroup>
						<thead>
							<tr>
								<th>글번호</th>
								<th>첨부</th>
								<th>제목</th>
								<th>글쓴이</th>
								<th>날짜</th>
								<th>조회수</th>
							</tr>
						</thead>
						<tbody>
						</tbody>
					</table>
				</div>
				<!-- pagination 영역 -->
				<div style="text-align: center;">
					<ul id="pagination" class="pagination"></ul>
				</div>

				<!-- bootstrap 모달박스:컨텍스트 메뉴를 출력할 영역-->
				<div id="modal1" class="modal fade" role="dialog">
					<div class="modal-dialog modal-sm">
						<div class="modal-content">
							<div class="modal-body" id="target">
								<ul>
									<li id="findJoinData" data-dismiss="modal">가입일 보기</li>
									<li id="readById" data-dismiss="modal">게시물 보기</li>
								</ul>
							</div>
						</div>
					</div>
				</div>
			</section>
		</div>
		<footer id="footer"> </footer>

	</div>
</body>
</html>















